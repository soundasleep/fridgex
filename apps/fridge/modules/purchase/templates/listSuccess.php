<?php
// auto-generated by sfPropelCrud
// date: 2008/07/25 14:15:28
?>
<h1>Recent activity</h1>

<?php use_helper("My"); ?>

<table>
<thead>
<tr>
  <th>Id</th>
  <th>Date</th>
  <th>User</th>
  <th>Product</th>
  <th>Quantity</th>
  <th>Credit</th>
  <th>Debit</th>
<?php if ($user->canVerifyCredit()) { ?>
  <th>Notes</th>
<?php } ?>
</tr>
</thead>
<tbody>
<?php $i = 0;
$last_day = 0;
foreach ($purchases as $purchase):
	$this_d = date("Y-m-d", strtotime($purchase->getCreatedAt()));
	if ($this_d != $last_day) {
		$i++;
		$last_day = $this_d;
	}
	?>
<tr class="<?php echo "day".($i%2); ?>">
    <td class="number"><?php echo $purchase->getId() ?></td>
      <td><?php echo my_format_date($purchase->getCreatedAt()) ?></td>
      <td><?php echo $purchase->getUser() ? link_to($purchase->getUser()->getNickname(), "user_admin/show?id=".$purchase->getUser()->getId(), array("class" => "username")) : "null" ?></td>
      <td><?php echo $purchase->getProduct() ? link_to($purchase->getProduct()->getTitle(), "product/show?id=".$purchase->getProduct()->getId()) : "null" ?></td>
      <td class="number"><?php echo format_number($purchase->getQuantity()) ?></td>
<?php if ($purchase->getQuantity() < 0) { ?>
      <td class="currency"></td>
      <td class="currency"><?php echo my_format_currency($purchase->getPrice() * $purchase->getQuantity()) ?></td>
<?php } else { ?>
      <td class="currency"><?php echo my_format_currency($purchase->getPrice() * $purchase->getQuantity()) ?></td>
      <td class="currency"></td>
<?php } ?>
<?php if ($user->canVerifyCredit()) { ?>
      <td><?php echo $purchase->getNotes(); ?>
		<?php if ($purchase->getQuantity() > 0 && !$purchase->isVerified()) { ?>
			<?php echo link_to("unverified", "purchase/credit"); ?>
		<?php } ?>
	  </td>
<?php } ?>
  </tr>
<?php endforeach; ?>
<?php if (!$purchases) { ?>
<tr>
	<td colspan="8" class="no_activity">No recent activity to show!</td>
</tr>
<?php } ?>
</tbody>
</table>
